<%- include('../partials/header') -%>

<main>
    <section>
    <h1>Zaloguj się</h1>

    <form id="loginForm">
        <input type="text" name="login" id="login" required placeholder="Login">
        <input type="password" name="password" id="password" required placeholder="Hasło">
        <button type="submit">Zaloguj</button>
    </form>
    <script>
        (function(){
            const form = document.getElementById('loginForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const login = document.getElementById('login').value;
                const password = document.getElementById('password').value;
                try {
                    const res = await fetch('/logIn', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ login, password }) });
                    const data = await res.json();
                    if (data.success) {
                        localStorage.setItem('user', data.username);
                        location.href = '/';
                    } else {
                        alert(data.message || 'Błąd logowania');
                    }
                } catch (err) { alert('Błąd połączenia'); }
            });
        })();
    </script>
    </section>
</main>

<%- include('../partials/footer') -%>